generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

// User & Authentication
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  avatar        String?
  timezone      String    @default("Africa/Johannesburg") // As requested in the prompt
  
  // Relationships
  yearPlans     YearPlan[]
  projects      Project[]
  tasks         Task[]
  clients       Client[]
  timeEntries   TimeEntry[]
  captures      Capture[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  calendarEvents CalendarEvent[]

  analyticsEvents AnalyticsEvent[]

  voiceSessions VoiceSession[]

  wellBeingEntries WellBeingEntry[]
  weekPlans     WeekPlan[]
  dayPlans      DayPlan[]
}

// Planning Hierarchy
model YearPlan {
  id            String    @id @default(cuid())
  userId        String
  year          Int
  theme         String
  vision        String    @db.Text
  focusAreas    String[]
  
  quarterPlans  QuarterPlan[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model QuarterPlan {
  id            String    @id @default(cuid())
  yearPlanId    String
  quarter       Int       // 1-4
  theme         String
  objectives    String[]
  
  monthPlans    MonthPlan[]
  
  startDate     DateTime
  endDate       DateTime
  
  yearPlan      YearPlan  @relation(fields: [yearPlanId], references: [id], onDelete: Cascade)
}

model MonthPlan {
  id              String    @id @default(cuid())
  quarterPlanId   String
  month           Int       // 1-12
  year            Int
  objectives      String[]
  
  weekPlans       WeekPlan[]
  
  completionRate  Float     @default(0)
  energyRating    Float?
  
  quarterPlan     QuarterPlan @relation(fields: [quarterPlanId], references: [id], onDelete: Cascade)
}

model WeekPlan {
  id                String    @id @default(cuid())
  userId            String
  monthPlanId       String
  weekNumber        Int
  year              Int
  startDate         DateTime
  endDate           DateTime
  
  topOutcomes       String[]
  plannedClientHours Float?
  plannedPersonalHours Float?
  
  dayPlans          DayPlan[]
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  monthPlan         MonthPlan @relation(fields: [monthPlanId], references: [id], onDelete: Cascade)

  @@index([userId, startDate, endDate])
}

model DayPlan {
  id              String    @id @default(cuid())
  userId          String
  weekPlanId      String
  date            DateTime  @db.Date
  
  topPriorities   String[]  // Task IDs
  
  morningEnergy   Float?
  afternoonEnergy Float?
  eveningEnergy   Float?
  
  dailyWin        String?
  gratitude       String[]
  tomorrowPrep    String[]
  
  timeBlocks      TimeBlock[]
  
  completionRate  Float     @default(0)
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  weekPlan        WeekPlan  @relation(fields: [weekPlanId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
}

model TimeBlock {
  id              String    @id @default(cuid())
  dayPlanId       String
  
  startTime       DateTime
  endTime         DateTime
  duration        Int       // minutes
  
  type            String    // deep_work, shallow_work, meeting, break, learning, admin
  
  taskId          String?
  projectId       String?
  clientId        String?
  
  actualStartTime DateTime?
  actualEndTime   DateTime?
  actualDuration  Int?
  
  energyBefore    Float?
  energyAfter     Float?
  focusQuality    Float?
  
  notes           String?   @db.Text
  
  dayPlan         DayPlan   @relation(fields: [dayPlanId], references: [id], onDelete: Cascade)
  task            Task?     @relation(fields: [taskId], references: [id])
  project         Project?  @relation(fields: [projectId], references: [id])
  client          Client?   @relation(fields: [clientId], references: [id])
}

// Projects & Tasks
model Project {
  id                  String    @id @default(cuid())
  userId              String
  name                String
  description         String?   @db.Text
  type                String    // client, personal, life_area, recurring
  status              String    // planning, active, on_hold, completed, cancelled
  
  // Client-specific
  clientId            String?
  billable            Boolean   @default(false)
  hourlyRate          Float?
  budgetHours         Float?
  
  // Timeline
  startDate           DateTime?
  deadline            DateTime?
  estimatedHours      Float?
  
  // Tracking
  actualHoursSpent    Float     @default(0)
  completionPercentage Float    @default(0)
  
  // Relationships
  goalId              String?
  parentProjectId     String?
  
  tasks               Task[]
  timeEntries         TimeEntry[]
  timeBlocks          TimeBlock[]
  
  // Metadata
  priority            String    // critical, high, medium, low
  tags                String[]
  color               String?   @default("#000000")
  icon                String?
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  completedAt         DateTime?
  archivedAt          DateTime?
  
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  client              Client?   @relation(fields: [clientId], references: [id])

  // Indexes for fast queries
  @@index([userId, status])
  @@index([userId, archivedAt])
  @@index([clientId])
}

model Task {
  id                String    @id @default(cuid())
  userId            String
  projectId         String?
  
  title             String
  description       String?   @db.Text
  
  status            String    @default("not_started") // not_started, in_progress, blocked, done, cancelled
  
  startedAt         DateTime?
  completedAt       DateTime?
  
  // Time tracking
  estimatedMinutes  Int?
  actualMinutes     Int       @default(0)
  timerRunning      Boolean   @default(false)
  currentTimerStart DateTime?
  
  // Scheduling
  scheduledDate     DateTime?
  dueDate           DateTime?
  
  // Organization
  priority          String    // critical, high, medium, low
  type              String    // deep_work, shallow_work, admin, meeting, learning
  tags              String[]
  
  // Relationships
  parentTaskId      String?
  dependsOn         String[]
  blocks            String[]
  
  // Energy
  energyRequired    Float?    // 1-10
  
  // Metadata
  isAdHoc           Boolean   @default(false)
  isRecurring       Boolean   @default(false)
  recurringPattern  String?
  
  timeEntries       TimeEntry[]
  timeBlocks        TimeBlock[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  project           Project?  @relation(fields: [projectId], references: [id])

  // Indexes for fast queries
  @@index([userId, status])
  @@index([userId, scheduledDate])
  @@index([userId, dueDate])
  @@index([userId, completedAt])
  @@index([userId, timerRunning])
  @@index([projectId])
}

model TimeEntry {
  id              String    @id @default(cuid())
  userId          String
  taskId          String?
  projectId       String?
  clientId        String?
  
  startTime       DateTime
  endTime         DateTime?
  duration        Int       // minutes
  
  type            String    // automatic, manual, timer
  
  description     String?   @db.Text
  tags            String[]
  
  // Quality metrics
  focusQuality    Float?
  energyBefore    Float?
  energyAfter     Float?
  distractions    Int       @default(0)
  
  // Billing
  billable        Boolean   @default(false)
  hourlyRate      Float?
  amount          Float     @default(0)
  invoiced        Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  task            Task?     @relation(fields: [taskId], references: [id])
  project         Project?  @relation(fields: [projectId], references: [id])
  client          Client?   @relation(fields: [clientId], references: [id])

  // Indexes for fast analytics queries
  @@index([userId, startTime])
  @@index([userId, billable])
  @@index([taskId])
  @@index([projectId])
}

// Clients & Communication
model Client {
  id                  String    @id @default(cuid())
  userId              String
  
  name                String
  companyName         String?
  email               String
  phone               String?
  
  // Contact details
  primaryContact      Json?     // {name, email, phone, role}
  additionalContacts  Json[]    // Array of contacts
  
  // Business
  industry            String?
  website             String?
  timezone            String?
  
  // Relationship
  relationshipHealth  Float?    // 1-10
  lastContactedAt     DateTime?
  preferredCommunication String? // email, phone, slack
  
  // Billing
  defaultHourlyRate   Float?
  paymentTerms        String?
  outstandingBalance  Float     @default(0)
  
  // Metadata
  notes               String?   @db.Text
  tags                String[]
  status              String    @default("active") // active, inactive, archived
  
  projects            Project[]
  timeEntries         TimeEntry[]
  timeBlocks          TimeBlock[]
  communications      Communication[]
  meetings            Meeting[]
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  lastInteractionAt   DateTime?
  
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Communication {
  id              String    @id @default(cuid())
  clientId        String
  projectId       String?
  
  type            String    // email, call, meeting, message
  direction       String    // inbound, outbound
  
  subject         String
  content         String    @db.Text
  summary         String?   @db.Text
  
  // Email specific
  from            String?
  to              String[]
  cc              String[]
  attachments     Json[]
  
  // Meeting specific
  meetingDate     DateTime?
  meetingDuration Int?
  attendees       String[]
  meetingNotes    String?   @db.Text
  
  // Tracking
  sentiment       String?   // positive, neutral, negative
  requiresFollowUp Boolean  @default(false)
  followUpDate    DateTime?
  
  createdAt       DateTime  @default(now())
  responseTime    Int?      // minutes
  
  client          Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model Meeting {
  id                String    @id @default(cuid())
  clientId          String?
  projectId         String?
  
  title             String
  description       String?   @db.Text
  type              String    // discovery, check_in, sprint_review, etc.
  
  scheduledAt       DateTime
  duration          Int       // minutes
  timezone          String
  
  // Attendees
  organizer         String
  requiredAttendees String[]
  optionalAttendees String[]
  
  // Location
  location          String?
  meetingLink       String?
  
  // Preparation & Notes
  agenda            String?   @db.Text
  meetingNotes      String?   @db.Text
  actionItems       Json[]
  decisions         String[]
  
  status            String    // scheduled, confirmed, completed, cancelled
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  client            Client?   @relation(fields: [clientId], references: [id])
}

// Well-being & Habits
model WellBeingEntry {
  id                String    @id @default(cuid())
  userId            String
  date              DateTime  @db.Date
  
  // Energy
  morningEnergy     Float?
  afternoonEnergy   Float?
  eveningEnergy     Float?
  averageEnergy     Float?
  
  // Habits
  exerciseMinutes   Int       @default(0)
  exerciseType      String?
  readingMinutes    Int       @default(0)
  learningMinutes   Int       @default(0)
  meditationMinutes Int       @default(0)
  sleepHours        Float?
  sleepQuality      Float?
  
  // Journaling
  morningJournal    String?   @db.Text
  eveningReflection String?   @db.Text
  gratitude         String[]
  dailyWin          String?
  
  // Mood
  mood              Float?    // 1-10
  stressLevel       Float?    // 1-10
  focusQuality      Float?    // 1-10
  
  notes             String?   @db.Text
  
  createdAt         DateTime  @default(now())
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
}

// Capture & Notes
model Capture {
  id                String    @id @default(cuid())
  userId            String
  
  type              String    // text, voice, handwritten, email, web, image
  content           String    @db.Text
  transcription     String?   @db.Text
  
  status            String    @default("inbox") // inbox, processed, archived
  
  convertedToTaskId String?
  convertedToNoteId String?
  
  // AI suggestions
  suggestedProject  String?
  suggestedDueDate  DateTime?
  suggestedPriority String?
  tags              String[]
  
  createdAt         DateTime  @default(now())
  processedAt       DateTime?
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VoiceSession {
  id              String    @id @default(cuid())
  userId          String
  
  title           String
  duration        Int       // seconds
  recordedAt      DateTime
  
  audioFileUrl    String
  waveformData    Json?
  
  transcription   String?   @db.Text
  speakers        Json[]
  timestamps      Json[]
  
  // AI processing
  summary         String?   @db.Text
  keyPoints       String[]
  actionItems     Json[]
  
  projectId       String?
  tags            String[]
  
  processed       Boolean   @default(false)
  archivedAt      DateTime?
  
  createdAt       DateTime  @default(now())
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Calendar
model CalendarEvent {
  id                  String    @id @default(cuid())
  userId              String
  
  title               String
  description         String?   @db.Text
  
  startTime           DateTime
  endTime             DateTime
  allDay              Boolean   @default(false)
  timezone            String
  
  // Recurrence
  isRecurring         Boolean   @default(false)
  recurrenceRule      String?
  
  // Relationships
  projectId           String?
  taskId              String?
  clientId            String?
  meetingId           String?
  
  type                String    // task, meeting, time_block, reminder, personal
  
  // Notifications
  reminders           Json[]
  
  color               String?
  location            String?
  attendees           String[]
  
  // External sync
  externalCalendarId  String?
  externalEventId     String?
  syncStatus          String?   // synced, pending, error
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Analytics
model AnalyticsEvent {
  id          String    @id @default(cuid())
  userId      String
  
  eventType   String    // page_view, task_completed, project_created, etc.
  eventData   Json?
  
  sessionId   String?
  
  createdAt   DateTime  @default(now())
  
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}
